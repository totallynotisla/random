(()=>{"use strict";var e=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{d(i.next(e))}catch(e){a(e)}}function r(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}d((i=i.apply(e,t||[])).next())}))};const t="cohere-token",n=()=>({Authorization:`bearer ${o()}`,"Content-Type":"application/json",Accept:"application/json"});function i(i){return e(this,void 0,void 0,(function*(){return i||(i=localStorage.getItem(t)),!(!i||(!i||!(yield(yield fetch("https://api.cohere.ai/v1/check-api-key",{headers:Object.assign(Object.assign({},n()),{Authorization:`bearer ${i}`}),method:"POST"})).json()).valid)&&(console.log("Invalid API key"),console.log("Please enter a valid API key"),1))}))}function o(){return localStorage.getItem(t)}function a(t){return e(this,arguments,void 0,(function*(e,{parts:t=0,history:i=[],final:o=[]}={},c){let r=Math.floor(1/3*100),d=`Summarize the ${t?1==t?`first ${r}% of the`:`next ${r}% of the`:""} story from this document, ${t>1?"START AFTER THE LAST SUMMARY DON'T REPEAT PREVIOUS SUMMARY":""} don't make anything up. Only use fact provided by the story. Use third person perspective, Make it into multiple paragraphs. Anything inside * or () is OOC, Out of character. Means, the character didnt actually say it.\nFor example *smile* means the character is smiling:`;console.log("Request to cohere ai");let l=[{title:"Story",text:e}];c&&c(t);let s=yield(yield fetch("https://api.cohere.ai/v1/chat",{body:JSON.stringify({preamble:"You are an ordinary man. you happened to like an interesting story\n\nYou got a job to summarize a story with the provided requirements without any questions",chat_history:i,documents:l,max_tokens:4090,temperature:.2,message:`${d}`}),method:"POST",headers:n()})).json();return console.log("Summary completed"),o.push({index:t,text:s.text}),null==t||0==t||t>=3?o:yield a(e,{parts:t+1,history:s.chat_history,final:o},c)}))}var c=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{d(i.next(e))}catch(e){a(e)}}function r(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}d((i=i.apply(e,t||[])).next())}))};const r="webhook-url";function d(){return localStorage.getItem(r)}function l(e){return c(this,arguments,void 0,(function*(e,{multiples:t=!1,index:n=0,max:i=3}={}){let o=new FormData;const a=new Blob([e],{type:"text/plain"});let c=d();if(!c)throw new Error("Webhook url didn't exist");o.append("payload_json",JSON.stringify({embeds:[{title:"Chat Summary",color:10026942,author:{name:t?`Part (${n}/${i})`:""},description:e.slice(0,4090),footer:{text:"Cohere AI",icon_url:"https://raw.githubusercontent.com/mangadi3859/random/main/cai/images/cohere.png"},timestamp:(new Date).toISOString()}],username:"Summary"})),o.append("file[0]",a,`summary${t?`-part-${n}`:""}.txt`),yield fetch(c,{headers:{"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrer:"https://discohook.org/",referrerPolicy:"strict-origin",body:o,method:"POST",mode:"cors",credentials:"omit"}),console.log("Completed")}))}var s=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{d(i.next(e))}catch(e){a(e)}}function r(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}d((i=i.apply(e,t||[])).next())}))};const u=()=>{return{headers:{Authorization:(null===(e=document.querySelector("[cai_token]"))||void 0===e?void 0:e.getAttribute("cai_token"))||""}};var e};function v(e){return s(this,arguments,void 0,(function*(e,t=!1,n=[],i){let o=yield function(e,t){return s(this,void 0,void 0,(function*(){return yield(yield fetch(`https://neo.character.ai/turns/${e}?next_token=${t}`,u())).json()}))}(e,i);var a;return n.push(...(a=o.turns,a.map((e=>`[${e.author.name}]\n<---- BEGIN ----\x3e\n${e.candidates[0].raw_content}\n<---- END ----\x3e`)))),t&&o.meta.next_token?v(e,t,n,o.meta.next_token):n}))}var y=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{d(i.next(e))}catch(e){a(e)}}function r(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}d((i=i.apply(e,t||[])).next())}))};document.querySelector(".cai_tools");const h=document.querySelector(".cait-body"),m=document.querySelector(".cai_tools-cont");!function(){y(this,void 0,void 0,(function*(){var n,p,f,b,g,S;const x=document.createElement("h6"),k=document.createElement("ul");x.innerText="Addon";const _=document.createElement("li"),L=document.createElement("li"),T=document.createElement("li"),w=document.createElement("div"),E=document.createElement("div"),I=document.createElement("div");function $(){w.classList.remove("active")}function q(){E.classList.remove("active")}function A(){I.classList.remove("active")}function M(){m.classList.remove("active")}_.innerText="Webhook",L.innerText="Cohere",T.innerText="Summarize",w.classList.add("cait_addons"),w.dataset.tool="cai_tools",w.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Webhook Settings</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: center;" class="cait_addons-footer">\n        <button id="caitHookSave" style="background-color: var(--btn-primary);" class="btn">Save</button>\n    </div>\n</div>',_.addEventListener("click",(function(){return y(this,void 0,void 0,(function*(){M(),w.classList.add("active");let e=w.querySelector(".cait_addons-body");e&&(e.innerHTML=`\n        <label for="caitHookInput">Webhook URL</label>\n        <textarea id="caitHookInput" class="text-input" data-cait="hookInput" style="width:100%;resize:vertical;" row="5">${d()}</textarea>\n        <div style="${(yield function(e){return c(this,void 0,void 0,(function*(){return e||(e=localStorage.getItem(r)),!(!e||(!/^(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])$/gi.test(e)||"discord.com"!=new URL(e).hostname||!(yield fetch(e)).ok)&&(console.log("Webhook url is invalid"),1))}))}())?"display:none;":""} color: var(--btn-danger);">Invalid webhook, please enter a valid discord webhook url</div>\n        \n`)}))})),null===(n=w.querySelector(".x-svg"))||void 0===n||n.addEventListener("click",$),w.addEventListener("click",(e=>e.target==w&&$())),null===(p=w.querySelector("#caitHookSave"))||void 0===p||p.addEventListener("click",(e=>y(this,void 0,void 0,(function*(){!function(e){c(this,void 0,void 0,(function*(){return localStorage.setItem(r,e)}))}(w.querySelector("#caitHookInput").value),$()})))),k.append(_,L,T),null==h||h.append(x,k),document.body.append(w),E.classList.add("cait_addons"),E.dataset.tool="cai_tools",E.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Cohere Settings</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: center;" class="cait_addons-footer">\n        <button id="caitCohereSave" style="background-color: var(--btn-primary);" class="btn">Save</button>\n    </div>\n</div>',L.addEventListener("click",(function(){return y(this,void 0,void 0,(function*(){M(),E.classList.add("active");let e=E.querySelector(".cait_addons-body");e&&(e.innerHTML=`\n        <label for="caitCohereInput">Cohere API Key</label>\n        <textarea id="caitCohereInput" class="text-input" data-cait="cohereInput" style="width:100%;resize:vertical;" row="5">${o()}</textarea>\n        <div style="${(yield i())?"display:none;":""} color: var(--btn-danger);">Invalid cohere ai TOKEN</div>\n`)}))})),null===(f=E.querySelector(".x-svg"))||void 0===f||f.addEventListener("click",q),E.addEventListener("click",(e=>e.target==E&&q())),null===(b=E.querySelector("#caitCohereSave"))||void 0===b||b.addEventListener("click",(n=>y(this,void 0,void 0,(function*(){let n=E.querySelector("#caitCohereInput");if(!(yield i(n.value)))return alert("Invalid cohere token. try again.");!function(n){e(this,void 0,void 0,(function*(){return localStorage.setItem(t,n)}))}(n.value),q()})))),document.body.append(E),I.classList.add("cait_addons"),I.dataset.tool="cai_tools",I.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Summary</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: start; gap: 1rem;" class="cait_addons-footer">\n        <button id="caitSumSubmit" style="background-color: var(--btn-primary);" class="btn">Generate</button>\n        <button id="caitSendHook" style="display: none;background-color: var(--btn-primary);" class="btn">Send Webhook</button>\n        <button id="caitCopySum" style="display: none;background-color: var(--btn-primary);" class="btn">Copy</button>\n        <button id="caitDoneSum" style="display: none;background-color: var(--btn-primary);" class="btn">Done</button>\n    </div>\n</div>',T.addEventListener("click",(function(){return y(this,void 0,void 0,(function*(){M();let e=I.querySelector("#caitSumSubmit"),t=yield i();t||e.classList.add("disabled"),e.disabled=!t,I.classList.add("active");let n=I.querySelector(".cait_addons-body");n&&(n.innerHTML=`\n        <div style="display:flex;align-items:center;gap:.5rem;">\n            <label class="normal" for="caitFetchAllInput">Fetch all message</label>\n            <input type="checkbox" id="caitFetchAllInput" data-cait="summaryInput" />\n        </div>\n        <div style="display:flex;align-items:center;gap:.5rem;">\n            <label class="normal" for="caitMultipleInput">Multiple Summaries</label>\n            <input type="checkbox" id="caitMultipleInput" data-cait="summaryInput" />\n        </div>\n        <div style="${t?"display:none;":""} color: var(--btn-danger);">Invalid cohere ai TOKEN</div>        \n`)}))})),null===(g=I.querySelector(".x-svg"))||void 0===g||g.addEventListener("click",A),I.addEventListener("click",(e=>e.target==I&&A())),null===(S=I.querySelector("#caitSumSubmit"))||void 0===S||S.addEventListener("click",(e=>y(this,void 0,void 0,(function*(){let t=e.target,n=document.querySelector("#caitSendHook"),i=document.querySelector("#caitDoneSum"),o=document.querySelector("#caitCopySum"),c=I.querySelector(".cait_addons-body");t.disabled=!0,t.innerText="Fetching chat data...";let r=function(){let e=window.location.pathname.match(/(?<=^\/chat\/).+$/);return e&&e[0]}(),d=yield function(e){return s(this,void 0,void 0,(function*(){return yield(yield fetch(`https://neo.character.ai/chats/recent/${e}`,u())).json()}))}(r);t.innerText="Fetching turns...";let h=c.querySelector("#caitFetchAllInput").checked,m=yield v(d.chats[0].chat_id,h);t.innerText="Generating Summaries...";let p=c.querySelector("#caitMultipleInput").checked,f=yield a(function(e){return e.reverse().map((e=>e.replace(/(\[-\])\(#-\s\"Memory:\s.+\"\)/g,""))).join("\n\n")}(m),{parts:p?1:0},(e=>{h&&(t.innerText=`Generating Summaries... (${e}/3)`)}));function b(e){return y(this,void 0,void 0,(function*(){yield navigator.clipboard.writeText(f.map((e=>e.text)).join("\n\n")),o.disabled=!0,o.innerText="Copied...",setTimeout((()=>{o.innerText="Copy",o.disabled=!1}),3e3)}))}function g(){n.style.display="none",i.style.display="none",o.style.display="none",t.innerText="Generate",n.innerText="Send Webhook",t.disabled=!1,n.disabled=!1,o.removeEventListener("click",b)}c.innerHTML=c.innerHTML+`\n            <label>Result</label>\n            <p class="text-input" style="height:10rem;padding-block:.5rem;">${f.map((e=>e.text)).join("<br/><br/>")}</p>\n        `,t.disabled=!0,t.innerText="completed...",n.style.display="block",o.style.display="block",i.style.display="block",i.addEventListener("click",(e=>y(this,void 0,void 0,(function*(){g(),A()}))),{once:!0}),o.addEventListener("click",b,{once:!0}),n.addEventListener("click",(e=>y(this,void 0,void 0,(function*(){n.innerText="Sending webhook...",n.disabled=!0;for(let e of f)yield l(e.text,{index:e.index,max:3,multiples:p});g(),A()}))),{once:!0})})))),document.body.append(I)}))}()})();
//# sourceMappingURL=content.js.map